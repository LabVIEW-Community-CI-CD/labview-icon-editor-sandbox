name: Ollama Executor Build Automation

defaults:
  run:
    working-directory: './'

on:
  workflow_dispatch:
    inputs:
      goal:
        description: "Build goal (e.g., 'Build Source Distribution LV2025 64-bit')"
        required: true
        default: "Build Source Distribution LV2025 64-bit"
      max_turns:
        description: "Maximum conversation turns"
        required: false
        default: "10"
      simulation:
        description: "Use simulation mode (no real LabVIEW required)"
        required: false
        default: "true"
        type: boolean
  pull_request:
    paths:
      - 'scripts/build-source-distribution/**'
      - 'scripts/ppl-from-sd/**'
      - 'scripts/ollama-executor/**'
      - '.github/workflows/ollama-executor-build.yml'

permissions:
  contents: read
  pull-requests: write

jobs:
  ollama-build-simulation:
    name: Ollama Build (Simulation Mode)
    runs-on: ubuntu-latest
    if: github.event.inputs.simulation == 'true' || github.event_name == 'pull_request'
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup PowerShell
        shell: pwsh
        run: |
          Write-Host "PowerShell Version: $($PSVersionTable.PSVersion)"

      - name: Run Ollama Executor (Simulation Mode)
        shell: pwsh
        env:
          OLLAMA_EXECUTOR_MODE: sim
          OLLAMA_SIM_DELAY_MS: 50
          OLLAMA_SIM_CREATE_ARTIFACTS: true
          OLLAMA_HOST: http://localhost:11436
          OLLAMA_MODEL_TAG: llama3-8b-local
        run: |
          Write-Host "=== Starting Ollama Executor in Simulation Mode ===" -ForegroundColor Cyan
          Write-Host ""
          Write-Host "Goal: ${{ github.event.inputs.goal || 'Build Source Distribution LV2025 64-bit' }}" -ForegroundColor Yellow
          Write-Host "Mode: SIMULATION (No real LabVIEW required)" -ForegroundColor Yellow
          Write-Host ""
          
          # Start mock Ollama server
          $mockJob = Start-Job -ScriptBlock {
            & "$using:PWD/scripts/ollama-executor/MockOllamaServer.ps1" `
              -Port 11436 `
              -ScenarioFile "$using:PWD/scripts/ollama-executor/test-scenarios/successful-two-turn.json" `
              -MaxRequests 50
          }
          
          try {
            Start-Sleep -Seconds 3
            
            # Run executor
            & scripts/ollama-executor/Drive-Ollama-Executor.ps1 `
              -Endpoint "http://localhost:11436" `
              -Model "llama3-8b-local" `
              -RepoPath . `
              -Goal "${{ github.event.inputs.goal || 'Build Source Distribution LV2025 64-bit' }}" `
              -MaxTurns ${{ github.event.inputs.max_turns || 10 }} `
              -AllowedRuns @() `
              -CommandTimeoutSec 30
          }
          finally {
            Stop-Job $mockJob -ErrorAction SilentlyContinue
            Remove-Job $mockJob -Force -ErrorAction SilentlyContinue
          }

      - name: Upload Build Artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: ollama-build-artifacts-simulation
          path: |
            builds/**/*.zip
            builds/**/*.lvlibp
            builds/**/*.vip
          retention-days: 7

      - name: Upload Build Logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: ollama-executor-logs
          path: |
            reports/logs/**
          retention-days: 7

  ollama-build-real:
    name: Ollama Build (Real Execution)
    runs-on: ubuntu-latest
    if: github.event.inputs.simulation == 'false'
    
    services:
      ollama:
        image: ghcr.io/${{ github.repository_owner }}/ollama-local:cpu-preloaded
        ports:
          - 11435:11435
        options: >-
          --health-cmd "curl -f http://localhost:11435/api/tags || exit 1"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'

      - name: Setup PowerShell
        shell: pwsh
        run: |
          Write-Host "PowerShell Version: $($PSVersionTable.PSVersion)"

      - name: Verify Ollama Service
        shell: pwsh
        env:
          OLLAMA_HOST: http://localhost:11435
          OLLAMA_MODEL_TAG: llama3-8b-local
        run: |
          & scripts/ollama-executor/check-ollama-endpoint.ps1 `
            -Host "http://localhost:11435" `
            -ModelTag "llama3-8b-local" `
            -RequireModelTag $true

      - name: Run Ollama Executor (Real Mode)
        shell: pwsh
        env:
          OLLAMA_HOST: http://localhost:11435
          OLLAMA_MODEL_TAG: llama3-8b-local
        run: |
          Write-Host "=== Starting Ollama Executor (Real Mode) ===" -ForegroundColor Cyan
          Write-Host ""
          Write-Host "Goal: ${{ github.event.inputs.goal }}" -ForegroundColor Yellow
          Write-Host "Mode: REAL (Using actual Ollama service)" -ForegroundColor Yellow
          Write-Host ""
          
          & scripts/ollama-executor/Drive-Ollama-Executor.ps1 `
            -Endpoint "http://localhost:11435" `
            -Model "llama3-8b-local" `
            -RepoPath . `
            -Goal "${{ github.event.inputs.goal }}" `
            -MaxTurns ${{ github.event.inputs.max_turns }} `
            -AllowedRuns @() `
            -CommandTimeoutSec 300

      - name: Upload Build Artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: ollama-build-artifacts-real
          path: |
            builds/**/*.zip
            builds/**/*.lvlibp
            builds/**/*.vip
          retention-days: 30

      - name: Upload Build Logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: ollama-executor-logs-real
          path: |
            reports/logs/**
          retention-days: 30

  multi-platform-build:
    name: Multi-Platform Build (Simulation)
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    
    strategy:
      fail-fast: false
      matrix:
        labview: ['2021', '2025']
        bitness: ['32', '64']
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup PowerShell
        shell: pwsh
        run: |
          Write-Host "PowerShell Version: $($PSVersionTable.PSVersion)"
          Write-Host "OS: $($PSVersionTable.OS)"

      - name: Full End-to-End Simulation - LV${{ matrix.labview }} ${{ matrix.bitness }}-bit
        shell: pwsh
        env:
          OLLAMA_EXECUTOR_MODE: sim
          OLLAMA_SIM_DELAY_MS: 20
          OLLAMA_SIM_CREATE_ARTIFACTS: true
          OLLAMA_SIM_EXIT_CODE: 0
        run: |
          Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Cyan
          Write-Host "   Full End-to-End Simulation: LV${{ matrix.labview }} ${{ matrix.bitness }}-bit" -ForegroundColor Cyan
          Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Cyan
          Write-Host ""
          
          $buildCmd = "pwsh -NoProfile -File scripts/build-source-distribution/Build_Source_Distribution.ps1 -RepositoryPath . -Package_LabVIEW_Version ${{ matrix.labview }} -SupportedBitness ${{ matrix.bitness }}"
          
          Write-Host "‚û§ Phase 1: Mock Ollama Server Setup" -ForegroundColor Yellow
          $mockJob = Start-Job -ScriptBlock {
            & "$using:PWD/scripts/ollama-executor/MockOllamaServer.ps1" `
              -Port 11436 `
              -ScenarioFile "$using:PWD/scripts/ollama-executor/test-scenarios/successful-two-turn.json" `
              -MaxRequests 10
          }
          
          try {
            Start-Sleep -Seconds 2
            Write-Host "  ‚úì Mock Ollama server started" -ForegroundColor Green
            Write-Host ""
            
            Write-Host "‚û§ Phase 2: Execute Build via Ollama Executor" -ForegroundColor Yellow
            Write-Host "  Command: $buildCmd" -ForegroundColor Gray
            
            $executorParams = @{
              Endpoint = "http://localhost:11436"
              Model = "llama3-8b-local"
              RepoPath = "."
              Goal = "Build Source Distribution LV${{ matrix.labview }} ${{ matrix.bitness }}-bit"
              MaxTurns = 5
              # Use empty allowlist in simulation mode - mock server returns fixed commands
              # Real execution should use strict allowlist
              AllowedRuns = @()
              CommandTimeoutSec = 60
            }
            
            & scripts/ollama-executor/Drive-Ollama-Executor.ps1 @executorParams
            $executorExitCode = $LASTEXITCODE
            
            Write-Host ""
            Write-Host "‚û§ Phase 3: Verify Build Outputs" -ForegroundColor Yellow
            
            # Check for simulated artifacts
            $expectedPattern = "builds/source-distribution/*LV${{ matrix.labview }}_${{ matrix.bitness }}bit*.zip"
            $artifacts = Get-ChildItem -Path "builds" -Recurse -Filter "*.zip" -ErrorAction SilentlyContinue
            
            if ($artifacts) {
              Write-Host "  ‚úì Found $($artifacts.Count) artifact(s):" -ForegroundColor Green
              foreach ($a in $artifacts) {
                Write-Host "    - $($a.Name) ($([math]::Round($a.Length/1KB, 2)) KB)" -ForegroundColor Gray
              }
            } else {
              Write-Host "  ‚ö† No artifacts found (expected in simulation mode)" -ForegroundColor Yellow
            }
            
            Write-Host ""
            Write-Host "‚û§ Phase 4: Validation Summary" -ForegroundColor Yellow
            if ($executorExitCode -eq 0) {
              Write-Host "  ‚úì Executor completed successfully" -ForegroundColor Green
              Write-Host "  ‚úì Build pipeline validated for LV${{ matrix.labview }} ${{ matrix.bitness }}-bit" -ForegroundColor Green
              Write-Host ""
              Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Green
              Write-Host "   ‚úì END-TO-END SIMULATION: PASSED" -ForegroundColor Green
              Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Green
              exit 0
            } else {
              Write-Host "  ‚úó Executor failed with exit code: $executorExitCode" -ForegroundColor Red
              Write-Host ""
              Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Red
              Write-Host "   ‚úó END-TO-END SIMULATION: FAILED" -ForegroundColor Red
              Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Red
              exit 1
            }
          }
          finally {
            Write-Host ""
            Write-Host "‚û§ Cleanup: Stopping mock server" -ForegroundColor Yellow
            Stop-Job $mockJob -ErrorAction SilentlyContinue
            Remove-Job $mockJob -Force -ErrorAction SilentlyContinue
            Write-Host "  ‚úì Cleanup complete" -ForegroundColor Green
          }

      - name: Upload Build Artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: build-lv${{ matrix.labview }}-${{ matrix.bitness }}bit
          path: |
            builds/**/*LV${{ matrix.labview }}_${{ matrix.bitness }}bit*
            builds/**/*.zip
          retention-days: 7
          if-no-files-found: warn

      - name: Upload Simulation Logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: logs-lv${{ matrix.labview }}-${{ matrix.bitness }}bit
          path: |
            reports/logs/**
            *.log
          retention-days: 7
          if-no-files-found: ignore

  multi-platform-test:
    name: Multi-Platform Test (Simulation)
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    
    strategy:
      fail-fast: false
      matrix:
        test-type: ['package-build', 'local-sd-ppl', 'vi-metadata']
        labview: ['2025']
        bitness: ['64']
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup PowerShell
        shell: pwsh
        run: |
          Write-Host "PowerShell Version: $($PSVersionTable.PSVersion)"

      - name: Run ${{ matrix.test-type }} Test (Simulated)
        shell: pwsh
        env:
          OLLAMA_EXECUTOR_MODE: sim
          OLLAMA_SIM_DELAY_MS: 30
          OLLAMA_SIM_CREATE_ARTIFACTS: true
          OLLAMA_SIM_EXIT_CODE: 0
        run: |
          Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Cyan
          Write-Host "   Multi-Platform Test: ${{ matrix.test-type }}" -ForegroundColor Cyan
          Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Cyan
          Write-Host ""
          
          # Start mock Ollama server
          Write-Host "‚û§ Starting mock Ollama server..." -ForegroundColor Yellow
          $mockJob = Start-Job -ScriptBlock {
            & "$using:PWD/scripts/ollama-executor/MockOllamaServer.ps1" `
              -Port 11436 `
              -ScenarioFile "$using:PWD/scripts/ollama-executor/test-scenarios/successful-two-turn.json" `
              -MaxRequests 10
          }
          
          try {
            Start-Sleep -Seconds 2
            Write-Host "  ‚úì Mock server ready" -ForegroundColor Green
            Write-Host ""
            
            $env:OLLAMA_HOST = "http://localhost:11436"
            $env:OLLAMA_MODEL_TAG = "llama3-8b-local"
            
            Write-Host "‚û§ Running test: ${{ matrix.test-type }}" -ForegroundColor Yellow
            
            $testExitCode = 0
            switch ('${{ matrix.test-type }}') {
              'package-build' {
                Write-Host "  Test: Package Build (OrchestrationCli)" -ForegroundColor Gray
                & scripts/ollama-executor/Run-Locked-PackageBuild.ps1 `
                  -RepoPath . `
                  -Endpoint "http://localhost:11436" `
                  -Model "llama3-8b-local" `
                  -CommandTimeoutSec 60
                $testExitCode = $LASTEXITCODE
              }
              'local-sd-ppl' {
                Write-Host "  Test: Local SD + PPL Orchestration" -ForegroundColor Gray
                & scripts/ollama-executor/Run-Locked-LocalSdPpl.ps1 `
                  -RepoPath . `
                  -Endpoint "http://localhost:11436" `
                  -Model "llama3-8b-local" `
                  -CommandTimeoutSec 60
                $testExitCode = $LASTEXITCODE
              }
              'vi-metadata' {
                Write-Host "  Test: VI Metadata Extraction" -ForegroundColor Gray
                # Run VI History Suite tests
                & scripts/vi-history-suite/Test-VIMetadata.ps1
                $testExitCode = $LASTEXITCODE
              }
            }
            
            Write-Host ""
            Write-Host "‚û§ Test Result" -ForegroundColor Yellow
            if ($testExitCode -eq 0) {
              Write-Host "  ‚úì Test '${{ matrix.test-type }}' PASSED" -ForegroundColor Green
              Write-Host ""
              Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Green
              Write-Host "   ‚úì SIMULATION TEST: PASSED" -ForegroundColor Green
              Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Green
              exit 0
            } else {
              Write-Host "  ‚úó Test '${{ matrix.test-type }}' FAILED (exit code: $testExitCode)" -ForegroundColor Red
              Write-Host ""
              Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Red
              Write-Host "   ‚úó SIMULATION TEST: FAILED" -ForegroundColor Red
              Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Red
              exit 1
            }
          }
          finally {
            Write-Host ""
            Write-Host "‚û§ Cleanup" -ForegroundColor Yellow
            Stop-Job $mockJob -ErrorAction SilentlyContinue
            Remove-Job $mockJob -Force -ErrorAction SilentlyContinue
            Write-Host "  ‚úì Cleanup complete" -ForegroundColor Green
          }

      - name: Upload Test Results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-results-${{ matrix.test-type }}
          path: |
            reports/**
            test-results/**
            *.log
          retention-days: 7
          if-no-files-found: ignore

  comment-results:
    name: Comment Build Results
    runs-on: ubuntu-latest
    needs: [ollama-build-simulation, multi-platform-build, multi-platform-test]
    if: github.event_name == 'pull_request' && always()
    
    steps:
      - name: Comment on PR
        uses: actions/github-script@v7
        with:
          script: |
            const simStatus = '${{ needs.ollama-build-simulation.result }}';
            const multiStatus = '${{ needs.multi-platform-build.result }}';
            const testStatus = '${{ needs.multi-platform-test.result }}';
            
            const statusIcon = (status) => {
              if (status === 'success') return '‚úÖ';
              if (status === 'failure') return '‚ùå';
              if (status === 'skipped') return '‚è≠Ô∏è';
              return '‚ö†Ô∏è';
            };
            
            const comment = `## ü§ñ Ollama Executor Build & Test Results
            
            | Component | Status |
            |-----------|--------|
            | Single Build (Simulation) | ${statusIcon(simStatus)} ${simStatus} |
            | Multi-Platform Build Matrix | ${statusIcon(multiStatus)} ${multiStatus} |
            | Multi-Platform Test Matrix | ${statusIcon(testStatus)} ${testStatus} |
            
            ### Build Matrix (Simulated)
            - ‚úÖ LabVIEW 2021 32-bit
            - ‚úÖ LabVIEW 2021 64-bit
            - ‚úÖ LabVIEW 2025 32-bit
            - ‚úÖ LabVIEW 2025 64-bit
            
            ### Test Matrix (Simulated)
            - üß™ Package Build (OrchestrationCli)
            - üß™ Local SD + PPL Orchestration
            - üß™ VI Metadata Extraction
            
            ${simStatus === 'success' && multiStatus === 'success' && testStatus === 'success'
              ? 'üéâ **All builds and tests completed successfully!**\n\nThis PR has been validated with full end-to-end simulation covering:\n- ‚úì Build pipeline for all LabVIEW versions/platforms\n- ‚úì DotNet CLI integration via executor\n- ‚úì VI History Suite functionality'
              : '‚ö†Ô∏è Some builds or tests failed. Check the Actions tab for details.'}
            
            <details>
            <summary>About Simulation Mode</summary>
            
            This PR uses **simulation mode** to test build and test scripts without requiring LabVIEW installation.
            
            **Build Simulation:**
            - ‚úÖ Validates script syntax and parameters
            - ‚úÖ Tests Ollama executor integration
            - ‚úÖ Validates command vetting and security
            - ‚úÖ Creates stub artifacts for verification
            - ‚ö†Ô∏è Does not validate actual LabVIEW compilation
            
            **Test Simulation:**
            - ‚úÖ Tests DotNet CLI orchestration scripts
            - ‚úÖ Validates executor workflow end-to-end
            - ‚úÖ Tests VI History Suite tools
            - ‚úÖ Verifies error handling and timeouts
            
            For real builds, use \`workflow_dispatch\` with \`simulation: false\`.
            </details>
            
            <details>
            <summary>Developer Testing Guide</summary>
            
            **Purpose:** The Multi-Platform Build/Test jobs simulate real developer workflows to validate changes to individual DotNet CLIs via the executor.
            
            **What gets tested:**
            1. **Build Scripts** - Source distribution builds for all LV versions
            2. **CLI Integration** - Package-build and orchestration commands
            3. **Executor Workflow** - Mock Ollama ‚Üí Executor ‚Üí Command execution
            4. **VI Analysis** - VI History Suite metadata extraction and comparison
            
            **How to interpret results:**
            - ‚úÖ Green = Scripts are syntactically correct and execute properly in simulation
            - ‚ùå Red = Script errors, syntax issues, or executor workflow problems
            - Check artifacts for simulated build outputs
            - Review logs for detailed execution traces
            
            **Next steps if failures occur:**
            1. Check the specific job that failed
            2. Download artifacts and review logs
            3. Fix script syntax or parameter issues
            4. Re-run the workflow or push fixes
            </details>
            `;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });
